name = "package-broker"
main = "packages/main/src/index.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

[vars]
ENCRYPTION_KEY = "ZGV2ZWxvcG1lbnRfZW5jcnlwdGlvbl9rZXlfMTIzNDU=" # "development_encryption_key_12345" base64
LOG_LEVEL = "debug"

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "package-broker-db"
database_id = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"

# KV Namespace for caching
[[kv_namespaces]]
binding = "KV"
id = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"

# Static Assets (UI)
[assets]
directory = "packages/ui/dist"
binding = "ASSETS"

# R2 Bucket for artifacts
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "package-broker-artifacts"

# Queue for async operations
[[queues.producers]]
binding = "QUEUE"
queue = "package-broker-queue"

[[queues.consumers]]
queue = "package-broker-queue"
max_batch_size = 10
max_batch_timeout = 30
